<!doctype html>

<html lang="en">

<head>
  <title>Rascando la superficie</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="The HTML5 Herald" />
  <meta name="author" content="Con Rafael La Buonora" /><meta name="generator" content="Hugo 0.65.3" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" />
  <script src="https://kit.fontawesome.com/b76b73e8e8.js" crossorigin="anonymous"></script>
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
  <link rel="stylesheet" type="text/css" href="/css/styles.css" /><link rel="icon" type="image/png" href="./favicon.png">

</head>

<body>
  <div id="container">
    <header>
      <h1>
                <a href="/">Rascando la superficie</a>
            </h1>

      <ul id="social-media">
        
        
        
        <li><a href="https://twitter.com/rlabuonora"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
          
        <li><a href="https://github.com/rlabuonora"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a></li>
           
        <li><a href="http://cv.rlabuonora.com"><i class="fas fa-file-alt" aria-hidden="true"></i></a></li>
        
      </ul>
      
      <p><em>Rafael La Buonora</em></p>
      
    </header>

    
<nav>
    <ul>
        
        <li>
            <a class="" href="/posts/">
                <i class="fa-li fa  fa-lg"></i><span>Posts</span>
            </a>
        </li>
        
        <li>
            <a class="" href="/about/">
                <i class="fa-li fa  fa-lg"></i><span>Este Blog</span>
            </a>
        </li>
        
    </ul>
</nav>

    <main>




<article>

    <h1>Visualizando homicidios, exámenes y la vacuna contra el sarampión</h1>

    
        <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2019-11-28T00:00:00Z">Nov 28, 2019</time>
        </li>
        

        
        <li>
            <em>
                
                    
                    <a href="/tags/r">#R</a>
                
                    , 
                    <a href="/tags/ggplot">#ggplot</a>
                
                    , 
                    <a href="/tags/tidytuesday">#tidytuesday</a>
                
            </em>
        </li>
        

        <li>7 minutes read</li>
    </ul>
</aside>

    

    <p>Este es mi primer post sobre tidy tuesday. Este proyecto, creado por <a href="https://twitter.com/thomas_mock">Thomas Mock</a>, publica un data set todo los martes y invita a los participantes a postear una visualización usándolo.</p>
<p>Para esta semana se publicaron tres juegos de datos provenientes de <a href="https://simplystatistics.org/2019/08/28/you-can-replicate-almost-any-plot-with-ggplot2/">este blog post</a>. La idea es mostrar el poder de <code>ggplot</code> para reproducir visualizaciones que encontró el autor por ahí.</p>
<h1 id="homicidios">Homicidios</h1>
<p>El primer dataset tiene la tasa de homicidios en 6 países del G-8:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">homicidios <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read_csv</span>(<span style="color:#a6e22e">here</span>(<span style="color:#e6db74">&#34;static&#34;</span>, <span style="color:#e6db74">&#34;data&#34;</span>, <span style="color:#e6db74">&#34;tidytuesday&#34;</span>,<span style="color:#e6db74">&#34;international_murders.csv&#34;</span>))

<span style="color:#a6e22e">head</span>(homicidios)
</code></pre></div><pre><code>## # A tibble: 6 x 4
##   country count label code 
##   &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
## 1 US       3.2  3.2   us   
## 2 ITALY    0.71 0.71  it   
## 3 CANADA   0.5  0.5   ca   
## 4 UK       0.1  0.1   gb   
## 5 JAPAN    0    0     jp   
## 6 GERMANY  0.2  0.2   de
</code></pre><p>Este es el gráfico original:</p>
<p><img src="https://abcnews.go.com/images/International/homocides_g8_countries_640x360_wmain.jpg" alt="grafico original"></p>
<p>Revisando la fuente de los datos encontré <a href="https://dataunodc.un.org/GSH_app">esta app</a>, sería interesante comparar a Uruguay en estos números, pero los datos no coinciden.</p>
<p>El diseño del gráfico es un bar chart, pero le agrega las banderas de los países y las tasas sobre las barras.</p>
<p>Este es el gráfico base con títulos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># plot basico</span>
g <span style="color:#f92672">&lt;-</span> homicidios <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(country, count)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_col</span>() <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;# de homicidios con armas de fuego \n cada 100,000 habitantes&#34;</span>, 
       caption <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Fuente: \nUNODC Homicide Statistics&#34;</span>,
       title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Tasa de Homicidios en países del G-8.&#34;</span>)
g
</code></pre></div><p><!-- raw HTML omitted --></p>
<p>Como mapeamos el eje x a una columna de texto, <code>ggplot</code> la convierte a un factor. El orden en el que aparecen los países en el eje depende de los niveles del factor, por defecto es alfabético:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">levels</span>(<span style="color:#a6e22e">factor</span>(homicidios<span style="color:#f92672">$</span>country))
</code></pre></div><pre><code>## [1] &quot;CANADA&quot;  &quot;FRANCE&quot;  &quot;GERMANY&quot; &quot;ITALY&quot;   &quot;JAPAN&quot;   &quot;RUSSIA&quot;  &quot;UK&quot;     
## [8] &quot;US&quot;
</code></pre><p>Esto es algo que puede confundir a alguien que no tiene experiencia trabajando con factores: el orden de los niveles es independiente del orden en que aparecen en el data frame.</p>
<p>En este caso, el orden del factor es alfabético (Canadá, Francia, etc.), y el data frame está ordenado por la tasa de homicidios (descendente): US, Italia, Canadá.</p>
<p>Para controlar el orden en el que aparecen los países ordenar las etiquetas, usamos una función muy útil de <code>forcats</code>: <code>fct_inorder</code>. Esta función reordena los niveles del factor para que coincida con el orden en el que aparecen en el data-frame:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">homicidios_2 <span style="color:#f92672">&lt;-</span> homicidios <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">arrange</span>(<span style="color:#f92672">-</span>count) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate</span>(country_ordenado <span style="color:#f92672">=</span> <span style="color:#a6e22e">fct_inorder</span>(country))

<span style="color:#a6e22e">levels</span>(homicidios_2<span style="color:#f92672">$</span>country_ordenado)
</code></pre></div><pre><code>## [1] &quot;US&quot;      &quot;ITALY&quot;   &quot;CANADA&quot;  &quot;GERMANY&quot; &quot;UK&quot;      &quot;FRANCE&quot;  &quot;JAPAN&quot;  
## [8] &quot;RUSSIA&quot;
</code></pre><p>Para la versión final, agrego las etiquetas del texto con <code>geom_text</code> (nudge_y me permite ajustar el texto un poco para que no toque las barras).</p>
<p>También descubrí <code>ggflags</code>, que nos da una función <code>geom_flag</code> con el <code>aes</code> country para especificar el país. La coordenada y de todas las banderas la fijo en -.4.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># install_github(&#34;rensa/ggflags&#34;)</span>

<span style="color:#a6e22e">library</span>(ggflags)
<span style="color:#a6e22e">library</span>(ggthemes)
<span style="color:#75715e"># theme_economist</span>
<span style="color:#75715e"># agrego texto sobre las columnas con geom_text y nudge_y</span>
homicidios <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">arrange</span>(<span style="color:#f92672">-</span>count) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate</span>(country <span style="color:#f92672">=</span> <span style="color:#a6e22e">fct_inorder</span>(country)) <span style="color:#f92672">%&gt;%</span> <span style="color:#75715e"># fct_inorder</span>
  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(country, count)) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">geom_col</span>(fill<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;darkred&#34;</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">geom_flag</span>(y <span style="color:#f92672">=</span> <span style="color:#ae81ff">-.4</span>, <span style="color:#a6e22e">aes</span>(country <span style="color:#f92672">=</span> code), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>) <span style="color:#f92672">+</span> <span style="color:#75715e"># geom_flag</span>
  <span style="color:#a6e22e">geom_text</span>(<span style="color:#a6e22e">aes</span>(label <span style="color:#f92672">=</span> <span style="color:#a6e22e">if_else</span>(country <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;RUSSIA&#34;</span>, <span style="color:#e6db74">&#34;S/D&#34;</span>, <span style="color:#a6e22e">as.character</span>(count))), 
                nudge_y <span style="color:#f92672">=</span> <span style="color:#ae81ff">.15</span>) <span style="color:#f92672">+</span> <span style="color:#75715e"># nudge, label</span>
  <span style="color:#a6e22e">scale_x_discrete</span>(labels<span style="color:#f92672">=</span><span style="color:#66d9ef">NULL</span>) <span style="color:#f92672">+</span> <span style="color:#75715e"># remove labels from x-axis</span>
  <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;# de homicidios con armas de fuego \n cada 100,000 habitantes&#34;</span>, 
       caption <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Fuente: \nUNODC Homicide Statistics&#34;</span>,
       title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Tasa de Homicidios en países del G-8&#34;</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">theme_economist</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(
    axis.line.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    axis.ticks.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    plot.caption <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(vjust <span style="color:#f92672">=</span> <span style="color:#ae81ff">170</span>) <span style="color:#75715e"># mover caption</span>
  )
</code></pre></div><p><!-- raw HTML omitted --></p>
<h1 id="diplopma-regents">Diplopma Regents</h1>
<p>Los exámenes Regents son una serie de tests estándar de temas de secundaria en el estado de Nueva York. Este set de datos muestra las notas de exámenes en varias materias. Lo que llama la atención es que hay un gran número de examenes con 65, la nota mínima de aprobación.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">nyc_regents <span style="color:#f92672">&lt;-</span>  <span style="color:#a6e22e">read_csv</span>(<span style="color:#a6e22e">here</span>(<span style="color:#e6db74">&#34;static&#34;</span>, <span style="color:#e6db74">&#34;data&#34;</span>, <span style="color:#e6db74">&#34;tidytuesday&#34;</span>,<span style="color:#e6db74">&#34;nyc_regents.csv&#34;</span>)
)
</code></pre></div><pre><code>## Parsed with column specification:
## cols(
##   score = col_double(),
##   integrated_algebra = col_double(),
##   global_history = col_double(),
##   living_environment = col_double(),
##   english = col_double(),
##   us_history = col_double()
## )
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># reshape</span>

nyc_reshape <span style="color:#f92672">&lt;-</span> nyc_regents <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">gather</span>(k<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;subject&#34;</span>, v<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tests&#34;</span>, <span style="color:#f92672">-</span>score) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">group_by</span>(score) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">summarize</span>(tests <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(tests, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))

<span style="color:#75715e"># plot basico</span>
g <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ggplot</span>(nyc_reshape, <span style="color:#a6e22e">aes</span>(score, tests)) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">geom_col</span>()

<span style="color:#75715e"># Texto</span>

g <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">labs</span>(caption <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Fuente: New York City Department of Education&#34;</span>,
       title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Salvar Raspando&#34;</span>,
       subtitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2010 Regents scores on Algebra, \nGlobal History, Biology, English &amp; US History&#34;</span>, 
       y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>, x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>)
</code></pre></div><pre><code>## Warning: Removed 1 rows containing missing values (position_stack).
</code></pre><p><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Ejes</span>
<span style="color:#75715e"># Scales en el grammar of graphics</span>
<span style="color:#75715e"># Customizando los ejes con scale_x_* y scale_y_*</span>
<span style="color:#75715e"># le pasamos una función a labels</span>
<span style="color:#75715e"># expand es contraintuitivamente importante</span>
<span style="color:#75715e"># labels, breaks, expand</span>
g <span style="color:#f92672">+</span> 
  
  <span style="color:#a6e22e">labs</span>(caption <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Source: New York City Department of Education&#34;</span>,
       title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Scraping By&#34;</span>,
       subtitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2010 Regents scores on Algebra, \nGlobal History, Biology, English &amp; US History&#34;</span>, 
       y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>, x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">scale_x_continuous</span>(breaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">5</span>), expand <span style="color:#f92672">=</span> <span style="color:#a6e22e">expand_scale</span>(add <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>))) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">scale_y_continuous</span>(position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;right&#34;</span>, 
                     labels <span style="color:#f92672">=</span> scales<span style="color:#f92672">::</span><span style="color:#a6e22e">number_format</span>(big.mark <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;,&#34;</span>), <span style="color:#75715e"># function</span>
                     breaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1e4</span>, <span style="color:#ae81ff">2e4</span>, <span style="color:#ae81ff">3e4</span>))
</code></pre></div><pre><code>## Warning: Removed 1 rows containing missing values (position_stack).
</code></pre><p><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Theme</span>
g <span style="color:#f92672">+</span> <span style="color:#a6e22e">labs</span>(caption <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Fuente: New York City Department of Education&#34;</span>,
       title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Salvar Raspando&#34;</span>,
       subtitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Notas 2010 Regents en Álgebra, \nHistoria, Biología, e Inglés&#34;</span>,
       y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>, x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">scale_x_continuous</span>(breaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">5</span>), expand <span style="color:#f92672">=</span> <span style="color:#a6e22e">expand_scale</span>(add <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>))) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">scale_y_continuous</span>(position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;right&#34;</span>, 
                     labels <span style="color:#f92672">=</span> scales<span style="color:#f92672">::</span><span style="color:#a6e22e">number_format</span>(big.mark <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;,&#34;</span>), <span style="color:#75715e"># function</span>
                     breaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1e4</span>, <span style="color:#ae81ff">2e4</span>, <span style="color:#ae81ff">3e4</span>)) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">theme_minimal</span>() <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">theme</span>(
    panel.grid.major.y <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_line</span>(linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dashed&#34;</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gray50&#34;</span>),
    panel.grid.major.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    panel.grid.minor <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    axis.text.y <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(vjust <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span>),
    axis.text.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(vjust <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>),
    plot.margin <span style="color:#f92672">=</span> <span style="color:#a6e22e">margin</span>(<span style="color:#a6e22e">unit</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>), <span style="color:#e6db74">&#34;cm&#34;</span>))
  )
</code></pre></div><pre><code>## Warning: Removed 1 rows containing missing values (position_stack).
</code></pre><p><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># color a las columnas</span>
<span style="color:#a6e22e">ggplot</span>(nyc_reshape, <span style="color:#a6e22e">aes</span>(score, tests)) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">geom_col</span>(color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>, fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#C4843C&#34;</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">labs</span>(caption <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Fuente: New York City Department of Education&#34;</span>,
       title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Salvar Raspando&#34;</span>,
       subtitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Notas 2010 Regents en Álgebra, \nHistoria, Biología, e Inglés&#34;</span>,
       y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>, x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">scale_x_continuous</span>(breaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">5</span>), expand <span style="color:#f92672">=</span> <span style="color:#a6e22e">expand_scale</span>(add <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>))) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">scale_y_continuous</span>(position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;right&#34;</span>, 
                     labels <span style="color:#f92672">=</span> scales<span style="color:#f92672">::</span><span style="color:#a6e22e">number_format</span>(big.mark <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;,&#34;</span>), <span style="color:#75715e"># function</span>
                     breaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1e4</span>, <span style="color:#ae81ff">2e4</span>, <span style="color:#ae81ff">3e4</span>)) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">theme_minimal</span>() <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">theme</span>(
    panel.grid.major.y <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_line</span>(linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dashed&#34;</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gray50&#34;</span>),
    panel.grid.major.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    panel.grid.minor <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    axis.text.y <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(vjust <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span>),
    axis.text.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(vjust <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>),
    plot.margin <span style="color:#f92672">=</span> <span style="color:#a6e22e">margin</span>(<span style="color:#a6e22e">unit</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>), <span style="color:#e6db74">&#34;cm&#34;</span>))
  )
</code></pre></div><pre><code>## Warning: Removed 1 rows containing missing values (position_stack).
</code></pre><p><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Todo junto</span>
nyc_regents <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">gather</span>(k<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;k&#34;</span>, v<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;v&#34;</span>, <span style="color:#f92672">-</span>score) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">group_by</span>(score) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">summarize</span>(v <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(v, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(score, v)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">annotate</span>(<span style="color:#e6db74">&#34;rect&#34;</span>, xmin <span style="color:#f92672">=</span> <span style="color:#ae81ff">65</span>, xmax<span style="color:#f92672">=</span><span style="color:#66d9ef">Inf</span>, ymin<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, ymax<span style="color:#f92672">=</span><span style="color:#66d9ef">Inf</span>, alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.6</span>, fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;grey80&#34;</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">annotate</span>(<span style="color:#e6db74">&#34;text&#34;</span>, 
           label <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Mìnimo para diploma Regents&#34;</span>,
           x <span style="color:#f92672">=</span> <span style="color:#ae81ff">45</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.5e4</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">annotate</span>(<span style="color:#e6db74">&#34;segment&#34;</span>, arrow<span style="color:#f92672">=</span><span style="color:#a6e22e">arrow</span>(type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;closed&#34;</span>, length <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">0.2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)), x<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>, y<span style="color:#f92672">=</span><span style="color:#ae81ff">2.8e4</span>, xend<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span>, yend<span style="color:#f92672">=</span><span style="color:#ae81ff">3.2e4</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">geom_col</span>(color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>, fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#C4843C&#34;</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">theme_minimal</span>() <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">scale_x_continuous</span>(breaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">5</span>), expand <span style="color:#f92672">=</span> <span style="color:#a6e22e">expand_scale</span>(add <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>))) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">scale_y_continuous</span>(position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;right&#34;</span>, 
                     labels <span style="color:#f92672">=</span> scales<span style="color:#f92672">::</span><span style="color:#a6e22e">number_format</span>(big.mark <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;,&#34;</span>), <span style="color:#75715e"># function</span>
                     breaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1e4</span>, <span style="color:#ae81ff">2e4</span>, <span style="color:#ae81ff">3e4</span>)) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">labs</span>(caption <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Fuente: New York City Department of Education&#34;</span>,
       title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Salvar Raspando&#34;</span>,
       subtitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Notas Regents 2010 en Álgebra, \nHistoria, Biología, e Inglés&#34;</span>,
       y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>, x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>, x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(
    panel.grid.major.y <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_line</span>(linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dashed&#34;</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gray50&#34;</span>),
    panel.grid.major.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    panel.grid.minor <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    axis.text.y <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(vjust <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span>),
    axis.text.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(vjust <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>),
    plot.margin <span style="color:#f92672">=</span> <span style="color:#a6e22e">margin</span>(<span style="color:#a6e22e">unit</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>), <span style="color:#e6db74">&#34;cm&#34;</span>)) <span style="color:#75715e"># </span>
  )
</code></pre></div><pre><code>## Warning: Removed 1 rows containing missing values (position_stack).
</code></pre><p><!-- raw HTML omitted --></p>
<h1 id="el-efecto-de-la-vacuna-contra-el-sarampión">El efecto de la vacuna contra el sarampión</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Measels</span>
<span style="color:#75715e"># devtools::install_github(&#34;rafalab/dslabs&#34;)</span>
<span style="color:#a6e22e">library</span>(dslabs)
diseases <span style="color:#f92672">&lt;-</span> dslabs<span style="color:#f92672">::</span>us_contagious_diseases

<span style="color:#75715e"># Research!</span>
jet.colors <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">colorRampPalette</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;#F0FFFF&#34;</span>, <span style="color:#e6db74">&#34;cyan&#34;</span>, <span style="color:#e6db74">&#34;#007FFF&#34;</span>, <span style="color:#e6db74">&#34;yellow&#34;</span>, <span style="color:#e6db74">&#34;#FFBF00&#34;</span>, <span style="color:#e6db74">&#34;orange&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;#7F0000&#34;</span>), bias <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.25</span>)


diseases <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">filter</span>(disease <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Measles&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">filter</span>(<span style="color:#f92672">!</span>state <span style="color:#f92672">%in%</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Hawaii&#34;</span>, <span style="color:#e6db74">&#34;Alaska&#34;</span>)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate</span>(rate <span style="color:#f92672">=</span> count <span style="color:#f92672">/</span> population <span style="color:#f92672">*</span> <span style="color:#ae81ff">10000</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">52</span> <span style="color:#f92672">/</span> weeks_reporting) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate</span>(state <span style="color:#f92672">=</span> <span style="color:#a6e22e">reorder</span>(state, <span style="color:#a6e22e">desc</span>(state))) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(year, state, fill<span style="color:#f92672">=</span>rate)) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">geom_tile</span>(color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">scale_fill_gradientn</span>(colors <span style="color:#f92672">=</span> <span style="color:#a6e22e">jet.colors</span>(<span style="color:#ae81ff">16</span>), na.value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Tasa&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#75715e">## research!</span>
  <span style="color:#a6e22e">scale_x_continuous</span>(expand <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>)) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>, title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Sarampión&#34;</span>, subtitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Enfermos cada 10000 habitantes&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_vline</span>(xintercept <span style="color:#f92672">=</span> <span style="color:#ae81ff">1963</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">annotate</span>(geom <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;text&#34;</span>, x<span style="color:#f92672">=</span><span style="color:#ae81ff">1970</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>, label <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Introducción de la vacuna&#34;</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">theme_minimal</span>() <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">coord_cartesian</span>(clip <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;off&#39;</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">theme</span>(
    legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>,
  )
</code></pre></div><p><!-- raw HTML omitted --></p>


</article>


<section class="post-nav">
    <ul>
        
        <li>
            <a href="/posts/personas-y-lugares-vargas-llosa/"><i class="fa fa-chevron-circle-left"></i> Personas y lugares en las novelas de Mario Vargas Llosa</a>
        </li>
        
        
        <li>
            <a href="/posts/metallica/">El estilo de Metallica a lo largo de los discos <i class="fa fa-chevron-circle-right"></i> </a>
        </li>
        
    </ul>
</section>
    





</main>
    <footer>
        <h6>Copyright © 2019 - Rafael La Buonora |
            Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a> |
            <a href="/index.xml">Subscribe</a></h6>
    </footer>
</div>
<script src="/js/scripts.js"></script>

  
<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>



</body>



</html>
